<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Sup</title>

    <style>* { box-sizing: border-box; font-family: Monospace; }</style>

  </head>
  <body>
    <h1>Sup?</h1>
    <form>
      <textarea name="message"></textarea>
      <input type="submit" />
    </form>

    <script>
      document.addEventListener('domloaded', function(event) {
        var xhr = new XMLHttpRequest();
      })

      document.querySelector('form').addEventListener('submit', function(event) {
        event.preventDefault();

        var message = event.target.message.value;

        http({
          method: "POST",
          path: '/message',
          body: {
            message: message
          }
        }, function(err, response, xhr) {
          if( response == "Mmkay." ) { return console.log("cool"); } //return window.location.reload();}

          window.alert("Nope.")
          console.error(response, xhr);
        })

        return false;
      })

      // options: method, url, body
      function http(options, cb) {
        if( !options.method ) { options.method = 'GET'; }
        if( !options.path && !options.url ) { return console.error("No url provided"); }

        options.url = options.url || window.location.protocol + '//' + window.location.hostname + ':' + window.location.port + options.path;

        var xhr = new XMLHttpRequest();

        xhr.open(options.method.toUpperCase(), options.url, true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.onreadystatechange = function() {
          if( xhr.readyState == 4 ) {
            return cb(null, xhr.responseText, xhr);
          }
        }

        if( options.body ) {
          xhr.send(JSON.stringify(options.body));
        } else {
          xhr.send();
        }
      }
    </script>
  </body>
</html>
